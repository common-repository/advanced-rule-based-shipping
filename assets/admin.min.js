(a=>{a("table.advanced_rule_based_shipping_rules_table .delete-shipping-rule").on("click",function(e){a(this).hasClass("delete-restrict-rule")?(e.preventDefault(),alert(advanced_rule_based_shipping_admin.i10n.restrict_delete_rule)):confirm(advanced_rule_based_shipping_admin.i10n.delete_rule_warning)||e.preventDefault()});let t=wp.hooks.applyFilters("advanced_rule_based_shipping_has_pro",!1);function i(e=66){var i=(new Date).getTime()+e,a="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random();return 0<i?(t=(i+t)%16|0,i=Math.floor(i/16)):(t=(a+t)%16|0,a=Math.floor(a/16)),("x"===e?t:3&t|8).toString(16)})}let s=e=>Object.assign({...advanced_rule_based_shipping_admin.select2_values_map},e.data("values-map"));var e={template:"#component-shipping-rule-item",components:{"shipping-rule-condition":{template:"#component-shipping-rule-condition",props:{condition:{type:Object},number:{type:Number,default:0}},data(){return{id:i(),...advanced_rule_based_shipping_admin.condition_values,...advanced_rule_based_shipping_admin.condition_ui_values,...this.condition}},computed:{get_pro_link(){return"https://codiepress.com/plugins/advanced-rule-based-shipping-pro/?utm_campaign=advanced+rule+based+shipping&utm_source=edit+rule&utm_medium=field+type&utm_term="+this.type}},beforeMount(){this.$parent.conditions[this.number]=this.$data},mounted(){wp.hooks.doAction("advanced_rule_based_shipping_condition_mounted",this),this.preload_layout_data()},beforeUpdate(){a(this.$refs.select2_ajax).data("select2")&&a(this.$refs.select2_ajax).select2("destroy"),a(this.$refs.select2_dropdown).data("select2")&&a(this.$refs.select2_dropdown).select2("destroy")},updated(){let t=this;a(this.$refs.select2_ajax).select2({placeholder:a(this).data("placeholder"),ajax:{url:advanced_rule_based_shipping_admin.ajax_url,dataType:"json",type:"POST",delay:500,data:function(e){var t=s(a(this));return{term:e.term,type:t.data_type,country:a(this).attr("data-country"),security:advanced_rule_based_shipping_admin.nonce_select2_data,action:"advanced_rule_based_shipping/get_select2_data"}},processResults:function(e){return{results:a.map(e.data,function(e){return{text:e.name,id:e.id}})}}}}).on("change",function(){var e=s(a(this)).model;e&&e.length&&(t[e]=a(this).val())}),a(this.$refs.select2_dropdown).select2({placeholder:a(this).data("placeholder")}).on("change",function(){var e=a(this).data("model");e&&e.length&&(t[e]=a(this).val())}),wp.hooks.doAction("advanced_rule_based_shipping_condition_updated",t)},watch:{type(){this.preload_layout_data()},cart_value_type:function(e){["in_categories","in_tags","in_shipping_classes"].includes(e)&&this.preload_layout_data()},...wp.hooks.applyFilters("advanced_rule_based_shipping_condition_watch",{})},methods:{get_countries(){return advanced_rule_based_shipping_admin.countries},get_ui_data_items(e){return Array.isArray(this[e])?this[e]:[]},delete_item(){confirm(advanced_rule_based_shipping_admin.i10n.delete_condition_warning)&&this.$parent.conditions.splice(this.number,1)},preload_layout_data(){this.$nextTick(()=>{if(this.$refs.select2_ajax){let i=s(a(this.$refs.select2_ajax));if(this[i.model]&&this[i.model].length){this.loading=!0;let t=new FormData;this[i.model].forEach(e=>{t.append("ids[]",e)}),t.append("type",i.data_type),t.append("security",advanced_rule_based_shipping_admin.nonce_select2_data),t.append("action","advanced_rule_based_shipping/get_select2_data"),wp.hooks.doAction("advanced_rule_based_shipping_preload_form_data",this,t),fetch(advanced_rule_based_shipping_admin.ajax_url,{method:"POST",body:t}).then(e=>e.json()).then(e=>{1==e.success&&(this[i.hold_data]=e.data)}).finally(()=>{this.loading=!1})}}}),wp.hooks.doAction("advanced_rule_based_shipping_condition_preload",this)},...wp.hooks.applyFilters("advanced_rule_based_shipping_condition_methods",{})}}},props:{rule:{type:Object},ruleNo:{type:Number,default:0}},data(){var e=JSON.parse(JSON.stringify(advanced_rule_based_shipping_admin.rule_values));return{id:i(),...e,...this.rule}},beforeMount(){this.$root.$data.rules[this.ruleNo]=this.$data},beforeUpdate(){this.$root.$data.rules[this.ruleNo]=this.$data},computed:{get_header_title(){return[this.title,advanced_rule_based_shipping_admin.shipping_cost_types[this.shipping_cost_type]].filter(e=>0<e.length).join(" - ")}},methods:{toggle_collapse(){this.collapse=!this.collapse},duplicate_rule(){this.$root.duplicate_rule(this.ruleNo)},delete_rule(){confirm(advanced_rule_based_shipping_admin.i10n.delete_shipping_rule_item_warning)&&this.$root.rules.splice(this.ruleNo,1)}}};let n=Vue.createApp({components:{"shipping-rule":e},data(){return{id:0,title:"",rules:[],error:"",saving:!1,show_pro_modal:!1}},computed:{get_free_rule_count(){return 4}},methods:{check_data(){return this.title.length?!(0<this.rules.map(e=>(e.title=e.title.trim(),e)).filter(e=>0==e.disabled&&0==e.title.length).length&&(this.error=advanced_rule_based_shipping_admin.i10n.error_title_missing,1)):(this.error=advanced_rule_based_shipping_admin.i10n.error_shipping_rule_title_missing,!1)},save_shipping_rule(){var e;this.error="",!1!==this.check_data()&&(this.saving=!0,(e=JSON.parse(JSON.stringify(this.rules))).forEach(e=>{delete e.id,Array.isArray(e.conditions)&&e.conditions.map(t=>{delete t.id,Object.keys(advanced_rule_based_shipping_admin.condition_ui_values).forEach(e=>{delete t[e]})})}),e={id:this.id,title:this.title,rules:JSON.stringify(e),_wpnonce:this.$refs.nonce.value,action:"advanced_rule_based_shipping/save_shipping_rule"},fetch(advanced_rule_based_shipping_admin.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e).toString()}).then(e=>e.json()).then(e=>{!0===e.success&&!0===e.data?.redirect&&(window.location=e.data.redirect_url)}).finally(()=>{this.saving=!1}))},add_new_rule(){this.rules.length>=this.get_free_rule_count&&!1===t?this.show_pro_modal=!0:this.rules.push({})},duplicate_rule(e){this.rules.length>=this.get_free_rule_count&&!1===t?this.show_pro_modal=!0:(e=JSON.parse(JSON.stringify(this.rules[e])),this.rules.push({...e,id:i(),collapse:!1,title:e.title+" - "+advanced_rule_based_shipping_admin.i10n.copy}))},onOrderChange(e){var t=this.rules.splice(e.oldIndex,1)[0];this.rules.splice(e.newIndex,0,t)},has_pro(){return t},get_button_classes(){return{button:!0,"button-save-rule":!0,"saving-rule":this.saving}}}}).use(sortablejs).mount("#form-advanced-rule-based-shipping");var d=a("#form-advanced-rule-based-shipping").data("settings");if("object"==typeof d)for(var r in d)n[r]=d[r];a(document).keyup(function(e){"Escape"===e.key&&(n.show_pro_modal=!1)})})(jQuery);